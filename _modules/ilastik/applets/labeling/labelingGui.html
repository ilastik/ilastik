<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ilastik.applets.labeling.labelingGui &#8212; ilastik 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="top" title="ilastik 1.0.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">ilastik 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ilastik.applets.labeling.labelingGui</h1><div class="highlight"><pre>
<span></span><span class="c1">###############################################################################</span>
<span class="c1">#   ilastik: interactive learning and segmentation toolkit</span>
<span class="c1">#</span>
<span class="c1">#       Copyright (C) 2011-2014, the ilastik developers</span>
<span class="c1">#                                &lt;team@ilastik.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or</span>
<span class="c1"># modify it under the terms of the GNU General Public License</span>
<span class="c1"># as published by the Free Software Foundation; either version 2</span>
<span class="c1"># of the License, or (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># In addition, as a special exception, the copyright holders of</span>
<span class="c1"># ilastik give you permission to combine ilastik with applets,</span>
<span class="c1"># workflows and plugins which are not covered under the GNU</span>
<span class="c1"># General Public License.</span>
<span class="c1">#</span>
<span class="c1"># See the LICENSE file for details. License information is also available</span>
<span class="c1"># on the ilastik web site at:</span>
<span class="c1">#		   http://ilastik.org/license.html</span>
<span class="c1">###############################################################################</span>
<span class="c1"># Built-in</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>

<span class="c1"># Third-party</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">uic</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="k">import</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QAction</span>

<span class="c1"># HCI</span>
<span class="kn">from</span> <span class="nn">volumina.api</span> <span class="k">import</span> <span class="n">LazyflowSinkSource</span><span class="p">,</span> <span class="n">ColortableLayer</span>
<span class="kn">from</span> <span class="nn">volumina.utility</span> <span class="k">import</span> <span class="n">ShortcutManager</span><span class="p">,</span> <span class="n">PreferencesManager</span>
<span class="kn">from</span> <span class="nn">ilastik.shell.gui.iconMgr</span> <span class="k">import</span> <span class="n">ilastikIcons</span>
<span class="kn">from</span> <span class="nn">ilastik.widgets.labelListView</span> <span class="k">import</span> <span class="n">Label</span>
<span class="kn">from</span> <span class="nn">ilastik.widgets.labelListModel</span> <span class="k">import</span> <span class="n">LabelListModel</span>

<span class="c1"># ilastik</span>
<span class="kn">from</span> <span class="nn">ilastik.utility</span> <span class="k">import</span> <span class="n">bind</span><span class="p">,</span> <span class="n">log_exception</span>
<span class="kn">from</span> <span class="nn">ilastik.utility.gui</span> <span class="k">import</span> <span class="n">ThunkEventHandler</span><span class="p">,</span> <span class="n">threadRouted</span>
<span class="kn">from</span> <span class="nn">ilastik.applets.layerViewer.layerViewerGui</span> <span class="k">import</span> <span class="n">LayerViewerGui</span>

<span class="kn">from</span> <span class="nn">ilastik.applets.labeling.labelingImport</span> <span class="k">import</span> <span class="n">import_labeling_layer</span>


<span class="c1"># Loggers</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c1">#===----------------------------------------------------------------------------------------------------------------===</span>

<span class="k">class</span> <span class="nc">Tool</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Enumerate the types of toolbar buttons.&quot;&quot;&quot;</span>
    <span class="n">Navigation</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Arrow</span>
    <span class="n">Paint</span>      <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Erase</span>      <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Threshold</span>  <span class="o">=</span> <span class="mi">3</span>

<div class="viewcode-block" id="LabelingGui"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui">[docs]</a><span class="k">class</span> <span class="nc">LabelingGui</span><span class="p">(</span><span class="n">LayerViewerGui</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides all the functionality of a simple layerviewer</span>
<span class="sd">    applet with the added functionality of labeling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">###########################################</span>
    <span class="c1">### AppletGuiInterface Concrete Methods ###</span>
    <span class="c1">###########################################</span>

    <span class="k">def</span> <span class="nf">centralWidget</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">appletDrawer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span>

    <span class="k">def</span> <span class="nf">stopAndCleanUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LabelingGui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">stopAndCleanUp</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="p">:</span>
            <span class="n">fn</span><span class="p">()</span>

    <span class="c1">###########################################</span>
    <span class="c1">###########################################</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minLabelNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minLabelNumber</span>
    <span class="nd">@minLabelNumber</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">minLabelNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minLabelNumber</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addNewLabel</span><span class="p">()</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maxLabelNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxLabelNumber</span>
    <span class="nd">@maxLabelNumber</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">maxLabelNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxLabelNumber</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_removeLastLabel</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labelingDrawerUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">labelListData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span>

<div class="viewcode-block" id="LabelingGui.selectLabel"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.selectLabel">[docs]</a>    <span class="k">def</span> <span class="nf">selectLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Programmatically select the given labelIndex, which start from 0.</span>
<span class="sd">           Equivalent to clicking on the (labelIndex+1)&#39;th position in the label widget.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">labelIndex</span><span class="p">)</span></div>

<div class="viewcode-block" id="LabelingGui.LabelingSlots"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.LabelingSlots">[docs]</a>    <span class="k">class</span> <span class="nc">LabelingSlots</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class serves as the parameter for the LabelingGui constructor.</span>
<span class="sd">        It provides the slots that the labeling GUI uses to source labels to the display and sink labels from the</span>
<span class="sd">        user&#39;s mouse clicks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Slot to insert elements onto</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelInput</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># labelInput.setInSlot(xxx)</span>
            <span class="c1"># Slot to read elements from</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelOutput</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># labelOutput.get(roi)</span>
            <span class="c1"># Slot that determines which label value corresponds to erased values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelEraserValue</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># labelEraserValue.setValue(xxx)</span>
            <span class="c1"># Slot that is used to request wholesale label deletion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelDelete</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># labelDelete.setValue(xxx)</span>
            <span class="c1"># Slot that gives a list of label names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelNames</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># labelNames.value</span></div>

<div class="viewcode-block" id="LabelingGui.__init__"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentApplet</span><span class="p">,</span> <span class="n">labelingSlots</span><span class="p">,</span> <span class="n">topLevelOperatorView</span><span class="p">,</span> <span class="n">drawerUiPath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rawInputSlot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crosshair</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param labelingSlots: Provides the slots needed for sourcing/sinking label data.  See LabelingGui.LabelingSlots</span>
<span class="sd">                              class source for details.</span>
<span class="sd">        :param topLevelOperatorView: is provided to the LayerViewerGui (the base class)</span>
<span class="sd">        :param drawerUiPath: can be given if you provide an extended drawer UI file.  Otherwise a default one is used.</span>
<span class="sd">        :param rawInputSlot: Data from the rawInputSlot parameter will be displayed directly underneath the elements</span>
<span class="sd">                             (if provided).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Do have have all the slots we need?</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labelingSlots</span><span class="p">,</span> <span class="n">LabelingGui</span><span class="o">.</span><span class="n">LabelingSlots</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelInput</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing a required slot.&quot;</span>
        <span class="k">assert</span> <span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelOutput</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing a required slot.&quot;</span>
        <span class="k">assert</span> <span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelEraserValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing a required slot.&quot;</span>
        <span class="k">assert</span> <span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelDelete</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing a required slot.&quot;</span>
        <span class="k">assert</span> <span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing a required slot.&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span> <span class="o">=</span> <span class="n">labelingSlots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minLabelNumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxLabelNumber</span> <span class="o">=</span> <span class="mi">99</span> <span class="c1">#100 or 255 is reserved for eraser</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rawInputSlot</span> <span class="o">=</span> <span class="n">rawInputSlot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">notifyDirty</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateLabelList</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">partial</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">unregisterDirty</span><span class="p">,</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateLabelList</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createDefault16ColorColorTable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_programmaticallyRemovingLabels</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">drawerUiPath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Default ui file</span>
            <span class="n">drawerUiPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/labelingDrawer.ui&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initLabelUic</span><span class="p">(</span><span class="n">drawerUiPath</span><span class="p">)</span>

        <span class="c1"># Init base class</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LabelingGui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parentApplet</span><span class="p">,</span>
                                          <span class="n">topLevelOperatorView</span><span class="p">,</span>
                                          <span class="p">[</span><span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelInput</span><span class="p">,</span> <span class="n">labelingSlots</span><span class="o">.</span><span class="n">labelOutput</span><span class="p">],</span>
                                          <span class="n">crosshair</span><span class="o">=</span><span class="n">crosshair</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initShortcuts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelEraserValue</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">erasingNumber</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allowDeleteLastLabelOnly</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Register for thunk events (easy UI calls from non-GUI threads)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thunkEventHandler</span> <span class="o">=</span> <span class="n">ThunkEventHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_changeInteractionMode</span><span class="p">(</span><span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_initLabelUic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawerUiPath</span><span class="p">):</span>
        <span class="n">_labelControlUi</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUi</span><span class="p">(</span><span class="n">drawerUiPath</span><span class="p">)</span>

        <span class="c1"># We own the applet bar ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span> <span class="o">=</span> <span class="n">_labelControlUi</span>

        <span class="c1"># Initialize the label list model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LabelListModel</span><span class="p">()</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListView</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">=</span><span class="n">model</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowsRemoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onLabelRemoved</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">elementSelected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onLabelSelected</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">handleClearRequested</span><span class="p">(</span> <span class="n">row</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Clear labels?&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;All &#39;</span><span class="si">{}</span><span class="s2">&#39; brush strokes will be erased.  Are you sure?&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                          <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selection</span> <span class="o">!=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># This only works if the top-level operator has a &#39;clearLabel&#39; function.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topLevelOperatorView</span><span class="o">.</span><span class="n">clearLabel</span><span class="p">(</span> <span class="n">row</span><span class="o">+</span><span class="mi">1</span> <span class="p">)</span>

        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListView</span><span class="o">.</span><span class="n">clearRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">handleClearRequested</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">handleLabelMergeRequested</span><span class="p">(</span><span class="n">from_row</span><span class="p">,</span> <span class="n">from_name</span><span class="p">,</span> <span class="n">into_row</span><span class="p">,</span> <span class="n">into_name</span><span class="p">):</span>
            <span class="n">from_label</span> <span class="o">=</span> <span class="n">from_row</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">into_label</span> <span class="o">=</span> <span class="n">into_row</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Merge labels?&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;All &#39;</span><span class="si">{}</span><span class="s2">&#39; brush strokes will be converted to &#39;</span><span class="si">{}</span><span class="s2">&#39;.  Are you sure?&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_name</span><span class="p">,</span> <span class="n">into_name</span><span class="p">),</span>
                          <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selection</span> <span class="o">!=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># This only works if the top-level operator has a &#39;mergeLabels&#39; function.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topLevelOperatorView</span><span class="o">.</span><span class="n">mergeLabels</span><span class="p">(</span> <span class="n">from_label</span><span class="p">,</span> <span class="n">into_label</span> <span class="p">)</span>

            <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">names</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">from_label</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span>

        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListView</span><span class="o">.</span><span class="n">mergeRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">handleLabelMergeRequested</span> <span class="p">)</span>

        <span class="c1"># Connect Applet GUI to our event handlers</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_labelControlUi</span><span class="p">,</span> <span class="s2">&quot;AddLabelButton&quot;</span><span class="p">):</span>
            <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">ilastikIcons</span><span class="o">.</span><span class="n">AddSel</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addNewLabel</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onLabelListDataChanged</span><span class="p">)</span>

        <span class="c1"># Initialize the arrow tool button with an icon and handler</span>
        <span class="n">iconPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/icons/arrow.png&quot;</span>
        <span class="n">arrowIcon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">iconPath</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">arrowIcon</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">checked</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleToolButtonClicked</span><span class="p">(</span><span class="n">checked</span><span class="p">,</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># Initialize the paint tool button with an icon and handler</span>
        <span class="n">paintBrushIconPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/icons/paintbrush.png&quot;</span>
        <span class="n">paintBrushIcon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">paintBrushIconPath</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">paintBrushIcon</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">checked</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleToolButtonClicked</span><span class="p">(</span><span class="n">checked</span><span class="p">,</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># Initialize the erase tool button with an icon and handler</span>
        <span class="n">eraserIconPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/icons/eraser.png&quot;</span>
        <span class="n">eraserIcon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">eraserIconPath</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">eraserIcon</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">checked</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleToolButtonClicked</span><span class="p">(</span><span class="n">checked</span><span class="p">,</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># Initialize the thresholding tool</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_labelControlUi</span><span class="p">,</span> <span class="s2">&quot;thresToolButton&quot;</span><span class="p">):</span>
            <span class="n">thresholdIconPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> \
              <span class="o">+</span> <span class="s2">&quot;/icons/threshold.png&quot;</span>
            <span class="n">thresholdIcon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">thresholdIconPath</span><span class="p">)</span>
            <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">thresholdIcon</span><span class="p">)</span>
            <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">checked</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleToolButtonClicked</span><span class="p">(</span><span class="n">checked</span><span class="p">,</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Threshold</span><span class="p">)</span> <span class="p">)</span>


        <span class="c1"># This maps tool types to the buttons that enable them</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_labelControlUi</span><span class="p">,</span> <span class="s2">&quot;thresToolButton&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolButtons</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span> <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="p">,</span>
                                 <span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span>      <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="p">,</span>
                                 <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span>      <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="p">,</span>
                                 <span class="n">Tool</span><span class="o">.</span><span class="n">Threshold</span>  <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolButtons</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span> <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="p">,</span>
                                 <span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span>      <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="p">,</span>
                                 <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span>      <span class="p">:</span> <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="p">}</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">61</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span><span class="p">:</span>
            <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onBrushSizeChange</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span> <span class="o">=</span> <span class="n">PreferencesManager</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;labeling&#39;</span><span class="p">,</span> <span class="s1">&#39;paint brush size&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span> <span class="o">=</span> <span class="n">PreferencesManager</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;labeling&#39;</span><span class="p">,</span> <span class="s1">&#39;eraser brush size&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span> <span class="p">)</span>

<div class="viewcode-block" id="LabelingGui.onLabelListDataChanged"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.onLabelListDataChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onLabelListDataChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topLeft</span><span class="p">,</span> <span class="n">bottomRight</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle changes to the label list selections.&quot;&quot;&quot;</span>
        <span class="n">firstRow</span> <span class="o">=</span> <span class="n">topLeft</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="n">lastRow</span>  <span class="o">=</span> <span class="n">bottomRight</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>

        <span class="n">firstCol</span> <span class="o">=</span> <span class="n">topLeft</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">lastCol</span>  <span class="o">=</span> <span class="n">bottomRight</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>

        <span class="c1"># We only care about the color column</span>
        <span class="k">if</span> <span class="n">firstCol</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">lastCol</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">firstRow</span> <span class="o">==</span> <span class="n">lastRow</span><span class="p">)</span> <span class="c1"># Only one data item changes at a time</span>

            <span class="c1">#in this case, the actual data (for example color) has changed</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">[</span><span class="n">firstRow</span><span class="p">]</span><span class="o">.</span><span class="n">brushColor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="p">[</span><span class="n">firstRow</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">rgba</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setBrushColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

            <span class="c1"># Update the label layer colortable to match the list entry</span>
            <span class="n">labellayer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabelLayer</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">labellayer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">labellayer</span><span class="o">.</span><span class="n">colorTable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span></div>

    <span class="k">def</span> <span class="nf">__initShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mgr</span> <span class="o">=</span> <span class="n">ShortcutManager</span><span class="p">()</span>
        <span class="n">ActionInfo</span> <span class="o">=</span> <span class="n">ShortcutManager</span><span class="o">.</span><span class="n">ActionInfo</span>
        <span class="n">shortcutGroupName</span> <span class="o">=</span> <span class="s2">&quot;Labeling&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="p">,</span> <span class="s2">&quot;AddLabelButton&quot;</span><span class="p">):</span>

            <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                          <span class="s2">&quot;New Label&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;Add New Label Class&quot;</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="o">.</span><span class="n">click</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">AddLabelButton</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                       <span class="s2">&quot;Navigation Cursor&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;Navigation Cursor&quot;</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="o">.</span><span class="n">click</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">arrowToolButton</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                       <span class="s2">&quot;Brush Cursor&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;Brush Cursor&quot;</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="o">.</span><span class="n">click</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">paintToolButton</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                       <span class="s2">&quot;Eraser Cursor&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;Eraser Cursor&quot;</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="o">.</span><span class="n">click</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">eraserToolButton</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                       <span class="s2">&quot;Decrease Brush Size&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;Decrease Brush Size&quot;</span><span class="p">,</span>
                                       <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tweakBrushSize</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                       <span class="s2">&quot;Increase Brush Size&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;Increase Brush Size&quot;</span><span class="p">,</span>
                                       <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tweakBrushSize</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="p">,</span> <span class="s2">&quot;thresToolButton&quot;</span><span class="p">):</span>
            <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="n">shortcutGroupName</span><span class="p">,</span>
                                           <span class="s2">&quot;Window Leveling&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;&lt;p&gt;Window Leveling can be used to adjust the data range used for visualization. Pressing the left mouse button while moving the mouse back and forth changes the window width (data range). Moving the mouse in the left-right plane changes the window mean. Pressing the right mouse button resets the view back to the original data.&quot;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="o">.</span><span class="n">click</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="o">.</span><span class="n">thresToolButton</span> <span class="p">)</span> <span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">_labelShortcuts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_tweakBrushSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">increase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Increment or decrement the paint brush size or eraser size (depending on which is currently selected).</span>
<span class="sd">        </span>
<span class="sd">        increase: Bool. If True, increment.  Otherwise, decrement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toolId</span> <span class="o">==</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">increase</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span> <span class="o">-=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changeInteractionMode</span><span class="p">(</span><span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">increase</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span> <span class="o">-=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changeInteractionMode</span><span class="p">(</span><span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_updateLabelShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">numShortcuts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelShortcuts</span><span class="p">)</span>
        <span class="n">numRows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">)</span>

        <span class="n">mgr</span> <span class="o">=</span> <span class="n">ShortcutManager</span><span class="p">()</span>
        <span class="n">ActionInfo</span> <span class="o">=</span> <span class="n">ShortcutManager</span><span class="o">.</span><span class="n">ActionInfo</span>
        <span class="c1"># Add any shortcuts we don&#39;t have yet.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numShortcuts</span><span class="p">,</span><span class="n">numRows</span><span class="p">):</span>
            <span class="n">toolTipObject</span> <span class="o">=</span> <span class="n">LabelListModel</span><span class="o">.</span><span class="n">EntryToolTipAdapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">action_info</span> <span class="o">=</span> <span class="n">ActionInfo</span><span class="p">(</span> <span class="s2">&quot;Labeling&quot;</span><span class="p">,</span> 
                                      <span class="s2">&quot;Select Label </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="s2">&quot;Select Label </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListView</span><span class="o">.</span><span class="n">selectRow</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListView</span><span class="p">,</span>
                                      <span class="n">toolTipObject</span> <span class="p">)</span>
            <span class="n">mgr</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">action_info</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelShortcuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">action_info</span> <span class="p">)</span>

        <span class="c1"># Make sure that all shortcuts have an appropriate description</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numRows</span><span class="p">):</span>
            <span class="n">action_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelShortcuts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Select &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="n">new_action_info</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">update_description</span><span class="p">(</span><span class="n">action_info</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelShortcuts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_action_info</span>

<div class="viewcode-block" id="LabelingGui.hideEvent"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.hideEvent">[docs]</a>    <span class="k">def</span> <span class="nf">hideEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        QT event handler.</span>
<span class="sd">        The user has selected another applet or is closing the whole app.</span>
<span class="sd">        Save all preferences.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">PreferencesManager</span><span class="p">()</span> <span class="k">as</span> <span class="n">prefsMgr</span><span class="p">:</span>
            <span class="n">prefsMgr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;labeling&#39;</span><span class="p">,</span> <span class="s1">&#39;paint brush size&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span><span class="p">)</span>
            <span class="n">prefsMgr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;labeling&#39;</span><span class="p">,</span> <span class="s1">&#39;eraser brush size&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LabelingGui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">hideEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_handleToolButtonClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">,</span> <span class="n">toolId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the user clicks any of the &quot;tool&quot; buttons in the label applet bar GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checked</span><span class="p">:</span>
            <span class="c1"># Users can only *switch between* tools, not turn them off.</span>
            <span class="c1"># If they try to turn a button off, re-select it automatically.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolButtons</span><span class="p">[</span><span class="n">toolId</span><span class="p">]</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the user is checking a new button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changeInteractionMode</span><span class="p">(</span> <span class="n">toolId</span> <span class="p">)</span>

    <span class="nd">@threadRouted</span>
    <span class="k">def</span> <span class="nf">_changeInteractionMode</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">toolId</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the GUI&#39;s response to the user selecting a new tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Uncheck all the other buttons</span>
        <span class="k">for</span> <span class="n">tool</span><span class="p">,</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolButtons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">tool</span> <span class="o">!=</span> <span class="n">toolId</span><span class="p">:</span>
                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># If we have no editor, we can&#39;t do anything yet</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># The volume editor expects one of two specific names</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelingDrawerUi</span><span class="p">,</span> <span class="s2">&quot;thresToolButton&quot;</span><span class="p">):</span>
            <span class="n">modeNames</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span>   <span class="p">:</span> <span class="s2">&quot;navigation&quot;</span><span class="p">,</span>
                          <span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span>        <span class="p">:</span> <span class="s2">&quot;brushing&quot;</span><span class="p">,</span>
                          <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span>        <span class="p">:</span> <span class="s2">&quot;brushing&quot;</span> <span class="p">,</span>
                          <span class="n">Tool</span><span class="o">.</span><span class="n">Threshold</span>    <span class="p">:</span> <span class="s2">&quot;thresholding&quot;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modeNames</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span>   <span class="p">:</span> <span class="s2">&quot;navigation&quot;</span><span class="p">,</span>
                          <span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span>        <span class="p">:</span> <span class="s2">&quot;brushing&quot;</span><span class="p">,</span>
                          <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span>        <span class="p">:</span> <span class="s2">&quot;brushing&quot;</span> <span class="p">}</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="p">,</span> <span class="s2">&quot;AddLabelButton&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxLabelNumber</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Add Label&quot;</span><span class="p">)</span>

        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gui_enableLabeling</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        
        <span class="c1"># Update the applet bar caption</span>
        <span class="k">if</span> <span class="n">toolId</span> <span class="o">==</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span><span class="p">:</span>
            <span class="c1"># update GUI </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gui_setNavigation</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">toolId</span> <span class="o">==</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span><span class="p">:</span>
            <span class="c1"># If necessary, tell the brushing model to stop erasing</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">erasing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">disableErasing</span><span class="p">()</span>
            <span class="c1"># Set the brushing size</span>
            <span class="n">brushSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setBrushSize</span><span class="p">(</span><span class="n">brushSize</span><span class="p">)</span>
            <span class="c1"># update GUI </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gui_setBrushing</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">toolId</span> <span class="o">==</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Erase</span><span class="p">:</span>
            <span class="c1"># If necessary, tell the brushing model to start erasing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">erasing</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setErasing</span><span class="p">()</span>
            <span class="c1"># Set the brushing size</span>
            <span class="n">eraserSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setBrushSize</span><span class="p">(</span><span class="n">eraserSize</span><span class="p">)</span>
            <span class="c1"># update GUI </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gui_setErasing</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">toolId</span> <span class="o">==</span> <span class="n">Tool</span><span class="o">.</span><span class="n">Threshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gui_setThresholding</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">setInteractionMode</span><span class="p">(</span> <span class="n">modeNames</span><span class="p">[</span><span class="n">toolId</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolId</span> <span class="o">=</span> <span class="n">toolId</span>
        
    <span class="k">def</span> <span class="nf">_gui_setThresholding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">thresToolButton</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gui_setErasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Size:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_gui_setNavigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">arrowToolButton</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># self._labelControlUi.arrowToolButton.setChecked(True) # why twice?</span>
    <span class="k">def</span> <span class="nf">_gui_setBrushing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Make sure the paint button is pressed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Show the brush size control and set its caption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Size:&quot;</span><span class="p">)</span>
        <span class="c1"># Make sure the GUI reflects the correct size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_gui_enableLabeling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">paintToolButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">eraserToolButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeCaption</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">brushSizeComboBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_onBrushSizeChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the user&#39;s new brush size selection.</span>
<span class="sd">        Note: The editor&#39;s brushing model currently maintains only a single</span>
<span class="sd">              brush size, which is used for both painting and erasing.</span>
<span class="sd">              However, we maintain two different sizes for the user and swap</span>
<span class="sd">              them depending on which tool is selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brushSizes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">erasing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eraserSizeIndex</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setBrushSize</span><span class="p">(</span><span class="n">newSize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paintBrushSizeIndex</span> <span class="o">=</span> <span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setBrushSize</span><span class="p">(</span><span class="n">newSize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onLabelSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;switching to label=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">[</span><span class="n">row</span><span class="p">]))</span>

        <span class="c1"># If the user is selecting a label, he probably wants to be in paint mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_changeInteractionMode</span><span class="p">(</span><span class="n">Tool</span><span class="o">.</span><span class="n">Paint</span><span class="p">)</span>

        <span class="c1">#+1 because first is transparent</span>
        <span class="c1">#FIXME: shouldn&#39;t be just row+1 here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setDrawnNumber</span><span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">brushColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">brushColor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingModel</span><span class="o">.</span><span class="n">setBrushColor</span><span class="p">(</span> <span class="n">brushColor</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resetLabelSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Resetting label selection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListView</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_changeInteractionMode</span><span class="p">(</span><span class="n">Tool</span><span class="o">.</span><span class="n">Navigation</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_updateLabelList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is called when the number of labels has changed without our knowledge.</span>
<span class="sd">        We need to add/remove labels until we have the right number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the number of labels in the label data</span>
        <span class="c1"># (Or the number of the labels the user has added.)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">value</span>
        <span class="n">numLabels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Add rows until we have the right number</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">numLabels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addNewLabel</span><span class="p">()</span>

        <span class="c1"># If we have too many rows, remove the rows that aren&#39;t in the list of names.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
            <span class="n">indices_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                    <span class="n">indices_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">i</span> <span class="p">)</span>
        
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">indices_to_remove</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># synchronize labelNames</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">n</span>
                
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="p">,</span> <span class="s2">&quot;AddLabelButton&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">AddLabelButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">numLabels</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxLabelNumber</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_addNewLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new label to the label list GUI control.</span>
<span class="sd">        Return the new number of labels in the control.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNextLabelName</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNextLabelColor</span><span class="p">(),</span>
                       <span class="n">pmapColor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getNextPmapColor</span><span class="p">(),</span>
                   <span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">nameChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateLabelShortcuts</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">nameChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onLabelNameChanged</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">colorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onLabelColorChanged</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">pmapColorChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onPmapColorChanged</span><span class="p">)</span>

        <span class="n">newRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span> <span class="n">newRow</span><span class="p">,</span> <span class="n">label</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowDeleteLastLabelOnly</span><span class="p">:</span>
            <span class="c1"># make previous label unremovable</span>
            <span class="k">if</span> <span class="n">newRow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">makeRowPermanent</span><span class="p">(</span><span class="n">newRow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">newColorIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">newRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onLabelListDataChanged</span><span class="p">(</span><span class="n">newColorIndex</span><span class="p">,</span> <span class="n">newColorIndex</span><span class="p">)</span> <span class="c1"># Make sure label layer colortable is in sync with the new color</span>

        <span class="c1"># Update operator with new name</span>
        <span class="n">operator_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator_names</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
            <span class="n">operator_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">label</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">operator_names</span><span class="p">,</span> <span class="n">check_changed</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># I have no idea why this is, but sometimes PyQt &quot;loses&quot; exceptions here.</span>
                <span class="c1"># Print it out before it&#39;s too late!</span>
                <span class="n">log_exception</span><span class="p">(</span> <span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;Logged the above exception just in case PyQt loses it.&quot;</span> <span class="p">)</span>
                <span class="k">raise</span>

        <span class="c1"># Call the &#39;changed&#39; callbacks immediately to initialize any listeners</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onLabelNameChanged</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onLabelColorChanged</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onPmapColorChanged</span><span class="p">()</span>

        <span class="c1"># Make the new label selected</span>
        <span class="n">nlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="n">selectedRow</span> <span class="o">=</span> <span class="n">nlabels</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selectedRow</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_updateLabelShortcuts</span><span class="p">()</span>
       
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gui_enableLabeling</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        
        <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>

<div class="viewcode-block" id="LabelingGui.getNextLabelName"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.getNextLabelName">[docs]</a>    <span class="k">def</span> <span class="nf">getNextLabelName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a suitable name for the next label added by the user.</span>
<span class="sd">        Subclasses may override this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maxNum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">):</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
                <span class="n">maxNum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxNum</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;Label </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxNum</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="LabelingGui.getNextLabelColor"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.getNextLabelColor">[docs]</a>    <span class="k">def</span> <span class="nf">getNextLabelColor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a QColor to use for the next label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numLabels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numLabels</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If the color table isn&#39;t large enough to handle all our labels,</span>
            <span class="c1">#  append a random color</span>
            <span class="n">randomColor</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">randomColor</span><span class="o">.</span><span class="n">rgba</span><span class="p">()</span> <span class="p">)</span>

        <span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">()</span>
        <span class="n">color</span><span class="o">.</span><span class="n">setRgba</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="p">[</span><span class="n">numLabels</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># First entry is transparent (for zero label)</span>
        <span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="LabelingGui.getNextPmapColor"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.getNextPmapColor">[docs]</a>    <span class="k">def</span> <span class="nf">getNextPmapColor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a QColor to use for the next label.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="LabelingGui.onLabelNameChanged"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.onLabelNameChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onLabelNameChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses can override this to respond to changes in the label names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="LabelingGui.onLabelColorChanged"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.onLabelColorChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onLabelColorChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses can override this to respond to changes in the label colors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="LabelingGui.onPmapColorChanged"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.onPmapColorChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onPmapColorChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses can override this to respond to changes in a label associated probability color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_removeLastLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Programmatically (i.e. not from the GUI) reduce the size of the label list by one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_programmaticallyRemovingLabels</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">numRows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
        <span class="c1"># This will trigger the signal that calls _onLabelRemoved()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateLabelShortcuts</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_programmaticallyRemovingLabels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_clearLabelListGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Remove rows until we have the right number</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_removeLastLabel</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onLabelRemoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="c1"># Don&#39;t respond unless this actually came from the GUI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_programmaticallyRemovingLabels</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">assert</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">start</span>

        <span class="n">oldcount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;removing label </span><span class="si">{}</span><span class="s2"> out of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">row</span><span class="p">,</span> <span class="n">oldcount</span> <span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowDeleteLastLabelOnly</span><span class="p">:</span>
            <span class="c1"># make previous label removable again</span>
            <span class="k">if</span> <span class="n">oldcount</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">makeRowRemovable</span><span class="p">(</span><span class="n">oldcount</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Remove the deleted label&#39;s color from the color table so that renumbered labels keep their colors.</span>
        <span class="n">oldColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Recycle the deleted color back into the table (for the next label to be added)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">oldcount</span><span class="p">,</span> <span class="n">oldColor</span><span class="p">)</span>

        <span class="c1"># Update the labellayer colortable with the new color mapping</span>
        <span class="n">labellayer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabelLayer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">labellayer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labellayer</span><span class="o">.</span><span class="n">colorTable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span>

        <span class="n">currentSelection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">selectedRow</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">currentSelection</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If we&#39;re deleting the currently selected row, then switch to a different row</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thunkEventHandler</span><span class="o">.</span><span class="n">post</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resetLabelSelection</span> <span class="p">)</span>

        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gui_enableLabeling</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># If the gui list model isn&#39;t in sync with the operator, update the operator.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelControlUi</span><span class="o">.</span><span class="n">labelListModel</span><span class="o">.</span><span class="n">rowCount</span><span class="p">():</span>
            <span class="c1"># Changing the deleteLabel input causes the operator (OpBlockedSparseArray)</span>
            <span class="c1">#  to search through the entire list of labels and delete the entries for the matching label.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelDelete</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
            <span class="c1"># We need to &quot;reset&quot; the deleteLabel input to -1 when we&#39;re finished.</span>
            <span class="c1">#  Otherwise, you can never delete the same label twice in a row.</span>
            <span class="c1">#  (Only *changes* to the input are acted upon.)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelDelete</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="n">labelNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">value</span>
            <span class="n">labelNames</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelNames</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">labelNames</span><span class="p">,</span> <span class="n">check_changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
       
<div class="viewcode-block" id="LabelingGui.getLayer"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.getLayer">[docs]</a>    <span class="k">def</span> <span class="nf">getLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;find a layer by name&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">labellayer</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">ifilter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">labellayer</span></div>

    <span class="k">def</span> <span class="nf">_getLabelLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLayer</span><span class="p">(</span><span class="s1">&#39;Labels&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="LabelingGui.createLabelLayer"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.createLabelLayer">[docs]</a>    <span class="k">def</span> <span class="nf">createLabelLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a colortable layer that displays the label slot data, along with its associated label source.</span>
<span class="sd">        direct: whether this layer is drawn synchronously by volumina</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labelOutput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelOutput</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">labelOutput</span><span class="o">.</span><span class="n">ready</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Add the layer to draw the labels, but don&#39;t add any labels</span>
            <span class="n">labelsrc</span> <span class="o">=</span> <span class="n">LazyflowSinkSource</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelOutput</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="o">.</span><span class="n">labelInput</span><span class="p">)</span>

            <span class="n">labellayer</span> <span class="o">=</span> <span class="n">ColortableLayer</span><span class="p">(</span><span class="n">labelsrc</span><span class="p">,</span> <span class="n">colorTable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colorTable16</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="n">direct</span> <span class="p">)</span>
            <span class="n">labellayer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Labels&quot;</span>
            <span class="n">labellayer</span><span class="o">.</span><span class="n">ref_object</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">labellayer</span><span class="o">.</span><span class="n">contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Import...&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                        <span class="n">triggered</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">import_labeling_layer</span><span class="p">,</span> <span class="n">labellayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labelingSlots</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span> <span class="p">)</span>

            <span class="n">labellayer</span><span class="o">.</span><span class="n">shortcutRegistration</span> <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">ShortcutManager</span><span class="o">.</span><span class="n">ActionInfo</span><span class="p">(</span>
                                                        <span class="s2">&quot;Labeling&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;LabelVisibility&quot;</span><span class="p">,</span>
                                                        <span class="s2">&quot;Show/Hide Labels&quot;</span><span class="p">,</span>
                                                        <span class="n">labellayer</span><span class="o">.</span><span class="n">toggleVisible</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">viewerControlWidget</span><span class="p">(),</span>
                                                        <span class="n">labellayer</span> <span class="p">)</span> <span class="p">)</span>

            <span class="k">return</span> <span class="n">labellayer</span><span class="p">,</span> <span class="n">labelsrc</span></div>

<div class="viewcode-block" id="LabelingGui.setupLayers"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.setupLayers">[docs]</a>    <span class="k">def</span> <span class="nf">setupLayers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the label layer for display by our base class (LayerViewerGui).</span>
<span class="sd">        If our subclass overrides this function to add his own layers,</span>
<span class="sd">        he **must** call this function explicitly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Labels</span>
        <span class="n">labellayer</span><span class="p">,</span> <span class="n">labelsrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createLabelLayer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">labellayer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labellayer</span><span class="p">)</span>

            <span class="c1"># Tell the editor where to draw label data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">setLabelSink</span><span class="p">(</span><span class="n">labelsrc</span><span class="p">)</span>

        <span class="c1"># Side effect 1: We want to guarantee that the label list</span>
        <span class="c1">#  is up-to-date before our subclass adds his layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateLabelList</span><span class="p">()</span>

        <span class="c1"># Raw Input Layer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rawInputSlot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rawInputSlot</span><span class="o">.</span><span class="n">ready</span><span class="p">():</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createStandardLayerFromSlot</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rawInputSlot</span> <span class="p">)</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Raw Input&quot;</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">layers</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_createDefault16ColorColorTable</span><span class="p">():</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Transparent for the zero label</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># ilastik v0.5 colors</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">red</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">green</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">yellow</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">blue</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">magenta</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">darkYellow</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">lightGray</span> <span class="p">)</span> <span class="p">)</span>
        <span class="c1"># Additional colors</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="p">)</span> <span class="c1">#hot pink</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span> <span class="p">)</span> <span class="c1">#dark aquamarine</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">165</span><span class="p">,</span>  <span class="mi">42</span><span class="p">,</span>  <span class="mi">42</span><span class="p">)</span> <span class="p">)</span> <span class="c1">#brown</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="p">)</span>     <span class="c1">#navy</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>   <span class="c1">#orange</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">173</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>  <span class="mi">47</span><span class="p">)</span> <span class="p">)</span> <span class="c1">#green-yellow</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="p">)</span>    <span class="c1">#purple</span>
        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span> <span class="p">)</span> <span class="c1">#khaki</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">rgba</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">]</span>


<div class="viewcode-block" id="LabelingGui.allowDeleteLastLabelOnly"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.labeling.labelingGui.LabelingGui.allowDeleteLastLabelOnly">[docs]</a>    <span class="k">def</span> <span class="nf">allowDeleteLastLabelOnly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In the TrackingWorkflow when labeling 0/1/2/.../N mergers we do not allow</span>
<span class="sd">        to remove another label but the first, as the following processing steps</span>
<span class="sd">        assume that all previous cell counts are given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allowDeleteLastLabelOnly</span> <span class="o">=</span> <span class="n">enabled</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">ilastik 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, Christoph Straehle, Bernhard X. Kausler, Thorben Krger, Ullrich Kthe , Fred A. Hamprecht, Anna Kreshuk, Luca Fiaschi, Stuart Berg.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>