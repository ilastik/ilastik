<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ilastik.applets.layerViewer.layerViewerGui &#8212; ilastik 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="top" title="ilastik 1.0.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">ilastik 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ilastik.applets.layerViewer.layerViewerGui</h1><div class="highlight"><pre>
<span></span><span class="c1">###############################################################################</span>
<span class="c1">#   ilastik: interactive learning and segmentation toolkit</span>
<span class="c1">#</span>
<span class="c1">#       Copyright (C) 2011-2014, the ilastik developers</span>
<span class="c1">#                                &lt;team@ilastik.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or</span>
<span class="c1"># modify it under the terms of the GNU General Public License</span>
<span class="c1"># as published by the Free Software Foundation; either version 2</span>
<span class="c1"># of the License, or (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># In addition, as a special exception, the copyright holders of</span>
<span class="c1"># ilastik give you permission to combine ilastik with applets,</span>
<span class="c1"># workflows and plugins which are not covered under the GNU</span>
<span class="c1"># General Public License.</span>
<span class="c1">#</span>
<span class="c1"># See the LICENSE file for details. License information is also available</span>
<span class="c1"># on the ilastik web site at:</span>
<span class="c1">#		   http://ilastik.org/license.html</span>
<span class="c1">###############################################################################</span>
<span class="c1">#Python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">traceLogger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;TRACE.&#39;</span> <span class="o">+</span> <span class="n">__name__</span><span class="p">)</span>

<span class="c1"># SciPy</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1">#PyQt</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">uic</span>

<span class="kn">import</span> <span class="nn">vigra</span>

<span class="c1">#lazyflow</span>
<span class="kn">from</span> <span class="nn">lazyflow.stype</span> <span class="k">import</span> <span class="n">ArrayLike</span>
<span class="kn">from</span> <span class="nn">lazyflow.operators</span> <span class="k">import</span> <span class="n">OpSingleChannelSelector</span><span class="p">,</span> <span class="n">OpWrapSlot</span>
<span class="kn">from</span> <span class="nn">lazyflow.operators.opReorderAxes</span> <span class="k">import</span> <span class="n">OpReorderAxes</span>

<span class="c1">#volumina</span>
<span class="kn">from</span> <span class="nn">volumina.api</span> <span class="k">import</span> <span class="n">LazyflowSource</span><span class="p">,</span> <span class="n">GrayscaleLayer</span><span class="p">,</span> <span class="n">RGBALayer</span><span class="p">,</span> <span class="n">ColortableLayer</span><span class="p">,</span> <span class="n">AlphaModulatedLayer</span><span class="p">,</span> <span class="n">LayerStackModel</span><span class="p">,</span> <span class="n">generateRandomColors</span>
<span class="kn">from</span> <span class="nn">volumina.volumeEditor</span> <span class="k">import</span> <span class="n">VolumeEditor</span>
<span class="kn">from</span> <span class="nn">volumina.utility</span> <span class="k">import</span> <span class="n">ShortcutManager</span>
<span class="kn">from</span> <span class="nn">volumina.interpreter</span> <span class="k">import</span> <span class="n">ClickReportingInterpreter</span>

<span class="c1">#ilastik</span>
<span class="kn">from</span> <span class="nn">ilastik.utility</span> <span class="k">import</span> <span class="n">bind</span>
<span class="kn">from</span> <span class="nn">ilastik.utility.gui</span> <span class="k">import</span> <span class="n">ThreadRouter</span><span class="p">,</span> <span class="n">threadRouted</span>
<span class="kn">from</span> <span class="nn">ilastik.config</span> <span class="k">import</span> <span class="n">cfg</span> <span class="k">as</span> <span class="n">ilastik_config</span>
<span class="kn">from</span> <span class="nn">ilastik.widgets.viewerControls</span> <span class="k">import</span> <span class="n">ViewerControls</span>

<span class="c1">#===----------------------------------------------------------------------------------------------------------------===</span>

<span class="k">class</span> <span class="nc">LayerViewerGuiMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">QWidget</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom metaclass to enable the _after_init function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is where __init__ is called.</span>
<span class="sd">        Here we can call code to execute immediately before or after the *subclass* __init__ function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Base class first. (type is our baseclass)</span>
        <span class="c1"># type.__call__ calls instance.__init__ internally</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LayerViewerGuiMetaclass</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_after_init</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">instance</span>

<div class="viewcode-block" id="LayerViewerGui"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.layerViewer.layerViewerGui.LayerViewerGui">[docs]</a><span class="k">class</span> <span class="nc">LayerViewerGui</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements an applet GUI whose central widget is a VolumeEditor</span>
<span class="sd">    and whose layer controls simply contains a layer list widget.</span>
<span class="sd">    Intended to be used as a subclass for applet GUI objects.</span>

<span class="sd">    Provides: Central widget (viewer), View Menu, and Layer controls</span>
<span class="sd">    Provides an EMPTY applet drawer widget.  Subclasses should replace it with their own applet drawer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">LayerViewerGuiMetaclass</span>
    
    <span class="c1">###########################################</span>
    <span class="c1">### AppletGuiInterface Concrete Methods ###</span>
    <span class="c1">###########################################</span>

    <span class="k">def</span> <span class="nf">centralWidget</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">appletDrawer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawer</span>

    <span class="k">def</span> <span class="nf">menus</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">debug_mode</span> <span class="o">=</span> <span class="n">ilastik_config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s2">&quot;ilastik&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumeEditorWidget</span><span class="o">.</span><span class="n">getViewMenu</span><span class="p">(</span><span class="n">debug_mode</span><span class="p">)</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">viewerControlWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__viewerControlWidget</span>

    <span class="k">def</span> <span class="nf">stopAndCleanUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stopped</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Remove all layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Unsubscribe to all signals</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="p">:</span>
            <span class="n">fn</span><span class="p">()</span>
            
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orphanOperators</span><span class="p">:</span>
            <span class="n">op</span><span class="o">.</span><span class="n">cleanUp</span><span class="p">()</span>

    <span class="c1">###########################################</span>
    <span class="c1">###########################################</span>

<div class="viewcode-block" id="LayerViewerGui.__init__"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.layerViewer.layerViewerGui.LayerViewerGui.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentApplet</span><span class="p">,</span> <span class="n">topLevelOperatorView</span><span class="p">,</span> <span class="n">additionalMonitoredSlots</span><span class="o">=</span><span class="p">[],</span> <span class="n">centralWidgetOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">crosshair</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.  **All** slots of the provided *topLevelOperatorView* will be monitored for changes.</span>
<span class="sd">        Changes include slot resize events, and slot ready/unready status changes.</span>
<span class="sd">        When a change is detected, the `setupLayers()` function is called, and the result is used to update the list of layers shown in the central widget.</span>

<span class="sd">        :param topLevelOperatorView: The top-level operator for the applet this GUI belongs to.</span>
<span class="sd">        :param additionalMonitoredSlots: Optional.  Can be used to add additional slots to the set of viewable layers (all slots from the top-level operator are already monitored).</span>
<span class="sd">        :param centralWidgetOnly: If True, provide only a central widget without drawer or viewer controls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LayerViewerGui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_stopped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threadRouter</span> <span class="o">=</span> <span class="n">ThreadRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># For using @threadRouted</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">topLevelOperatorView</span> <span class="o">=</span> <span class="n">topLevelOperatorView</span>

        <span class="n">observedSlots</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">topLevelOperatorView</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">+</span> <span class="n">topLevelOperatorView</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">slot</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">observedSlots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        
        <span class="n">observedSlots</span> <span class="o">+=</span> <span class="n">additionalMonitoredSlots</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orphanOperators</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Operators that are owned by this GUI directly (not owned by the top-level operator)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observedSlots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">observedSlots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slot</span><span class="o">.</span><span class="n">stype</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">):</span>
                    <span class="c1"># We don&#39;t support visualization of non-Array slots.</span>
                    <span class="k">continue</span>
                <span class="c1"># To be monitored and updated correctly by this GUI, slots must have level=1, but this slot is of level 0.</span>
                <span class="c1"># Pass it through a trivial &quot;up-leveling&quot; operator so it will have level 1 for our purposes.</span>
                <span class="n">opPromoteInput</span> <span class="o">=</span> <span class="n">OpWrapSlot</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">slot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
                <span class="n">opPromoteInput</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
                <span class="n">slot</span> <span class="o">=</span> <span class="n">opPromoteInput</span><span class="o">.</span><span class="n">Output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_orphanOperators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">opPromoteInput</span> <span class="p">)</span>

            <span class="c1"># Each slot should now be indexed as slot[layer_index]</span>
            <span class="k">assert</span> <span class="n">slot</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observedSlots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">slot</span> <span class="p">)</span>
            <span class="n">slot</span><span class="o">.</span><span class="n">notifyInserted</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handleLayerInsertion</span><span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">partial</span><span class="p">(</span> <span class="n">slot</span><span class="o">.</span><span class="n">unregisterInserted</span><span class="p">,</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handleLayerInsertion</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

            <span class="n">slot</span><span class="o">.</span><span class="n">notifyRemoved</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handleLayerRemoval</span><span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">partial</span><span class="p">(</span> <span class="n">slot</span><span class="o">.</span><span class="n">unregisterRemoved</span><span class="p">,</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handleLayerRemoval</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">slot</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handleLayerInsertion</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
 
        <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span> <span class="o">=</span> <span class="n">LayerStackModel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initCentralUic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initEditor</span><span class="p">(</span><span class="n">crosshair</span><span class="o">=</span><span class="n">crosshair</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__viewerControlWidget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">centralWidgetOnly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initViewerControlUi</span><span class="p">()</span> <span class="c1"># Might be overridden in a subclass. Default implementation loads a standard layer widget.</span>
            <span class="c1">#self._drawer = QWidget( self )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initAppletDrawerUi</span><span class="p">()</span> <span class="c1"># Default implementation loads a blank drawer from drawer.ui.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_up_to_date</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># By default, we start out disabled until we have at least one layer.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">()</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>
        
    <span class="k">def</span> <span class="nf">_after_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateAllLayers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setNeedUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_update</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
                <span class="n">slot</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">call_when_setup_finished</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateAllLayers</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateAllLayers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateAllLayers</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span> <span class="n">LayerViewerGui</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">showEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<div class="viewcode-block" id="LayerViewerGui.setupLayers"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.layerViewer.layerViewerGui.LayerViewerGui.setupLayers">[docs]</a>    <span class="k">def</span> <span class="nf">setupLayers</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a list of layers to be displayed in the central widget.</span>
<span class="sd">        Subclasses should override this method to create the list of layers that can be displayed.</span>
<span class="sd">        For debug and development purposes, the base class implementation simply generates layers for all topLevelOperatorView slots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">multiLayerSlot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observedSlots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">slot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">multiLayerSlot</span><span class="p">):</span>                
                <span class="n">has_space</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span><span class="o">.</span><span class="n">axisTypeCount</span><span class="p">(</span><span class="n">vigra</span><span class="o">.</span><span class="n">AxisType</span><span class="o">.</span><span class="n">Space</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span> <span class="ow">and</span> <span class="n">has_space</span><span class="p">:</span>
                    <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createStandardLayerFromSlot</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
                    
                    <span class="c1"># Name the layer after the slot name.</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">multiLayerSlot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">(),</span> <span class="n">OpWrapSlot</span> <span class="p">):</span>
                        <span class="c1"># We attached an &#39;upleveling&#39; operator, so look upstream for the real slot.</span>
                        <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">multiLayerSlot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">multiLayerSlot</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">layers</span></div>

    <span class="k">def</span> <span class="nf">_handleLayerInsertion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">slotIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The multislot providing our layers has a new item.</span>
<span class="sd">        Make room for it in the layer GUI and subscribe to updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># When the slot is ready, we&#39;ll replace the blank layer with real data</span>
        <span class="n">slot</span><span class="p">[</span><span class="n">slotIndex</span><span class="p">]</span><span class="o">.</span><span class="n">notifyReady</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNeedUpdate</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">slot</span><span class="p">[</span><span class="n">slotIndex</span><span class="p">]</span><span class="o">.</span><span class="n">notifyUnready</span><span class="p">(</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNeedUpdate</span><span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">partial</span><span class="p">(</span> <span class="n">slot</span><span class="p">[</span><span class="n">slotIndex</span><span class="p">]</span><span class="o">.</span><span class="n">unregisterReady</span><span class="p">,</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNeedUpdate</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cleanup_fns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">partial</span><span class="p">(</span> <span class="n">slot</span><span class="p">[</span><span class="n">slotIndex</span><span class="p">]</span><span class="o">.</span><span class="n">unregisterUnready</span><span class="p">,</span> <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNeedUpdate</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>


    <span class="k">def</span> <span class="nf">_handleLayerRemoval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">slotIndex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An item is about to be removed from the multislot that is providing our layers.</span>
<span class="sd">        Remove the layer from the GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNeedUpdate</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generateAlphaModulatedLayersFromChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">assert</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="LayerViewerGui.createStandardLayerFromSlot"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.layerViewer.layerViewerGui.LayerViewerGui.createStandardLayerFromSlot">[docs]</a>    <span class="k">def</span> <span class="nf">createStandardLayerFromSlot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">lastChannelIsAlpha</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience function.</span>
<span class="sd">        Generates a volumina layer using the given slot.  </span>
<span class="sd">        Will be either a GrayscaleLayer or RGBALayer, depending on the channel metadata.</span>

<span class="sd">        :param slot: The slot to generate a layer from</span>
<span class="sd">        :param lastChannelIsAlpha: If True, the last channel in the slot is assumed to be an alpha channel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numChannels</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="n">c_index</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span><span class="p">):</span>
            <span class="n">numChannels</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">c_index</span><span class="p">]</span>
            <span class="n">display_mode</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">display_mode</span>
                
        <span class="k">if</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="c1">## Figure out whether the default should be rgba or grayscale</span>
            <span class="k">if</span> <span class="n">lastChannelIsAlpha</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">numChannels</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">,</span> \
                    <span class="s2">&quot;This function doesn&#39;t support alpha for slots with more than 4 channels.  &quot;</span>\
                    <span class="s2">&quot;Your image has </span><span class="si">{}</span><span class="s2"> channels.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numChannels</span><span class="p">)</span>

            <span class="c1"># Automatically select Grayscale or RGBA based on number of channels</span>
            <span class="k">if</span> <span class="n">numChannels</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">numChannels</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;rgba&quot;</span>
            <span class="k">elif</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span>
                <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;random-colortable&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;grayscale&quot;</span>

        <span class="c1"># Override RGBA --&gt; Grayscale if there&#39;s only 1 channel.</span>
        <span class="k">if</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;rgba&quot;</span> <span class="ow">and</span> <span class="n">numChannels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">display_mode</span> <span class="o">=</span> <span class="s2">&quot;grayscale&quot;</span>
                
        <span class="k">if</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;grayscale&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">lastChannelIsAlpha</span><span class="p">,</span> <span class="s2">&quot;Can&#39;t have an alpha channel if there is no color channel&quot;</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_create_grayscale_layer_from_slot</span><span class="p">(</span> <span class="n">slot</span><span class="p">,</span> <span class="n">numChannels</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;rgba&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">numChannels</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numChannels</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lastChannelIsAlpha</span><span class="p">),</span> \
                <span class="s2">&quot;Unhandled combination of channels.  numChannels=</span><span class="si">{}</span><span class="s2">, lastChannelIsAlpha=</span><span class="si">{}</span><span class="s2">, axistags=</span><span class="si">{}</span><span class="s2">&quot;</span>\
                <span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">numChannels</span><span class="p">,</span> <span class="n">lastChannelIsAlpha</span><span class="p">,</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_create_rgba_layer_from_slot</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span> <span class="n">numChannels</span><span class="p">,</span> <span class="n">lastChannelIsAlpha</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;random-colortable&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_create_random_colortable_layer_from_slot</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;alpha-modulated&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_create_alpha_modulated_layer_from_slot</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">display_mode</span> <span class="o">==</span> <span class="s2">&quot;binary-mask&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_create_binary_mask_layer_from_slot</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;unknown channel display mode: &quot;</span> <span class="o">+</span> <span class="n">display_mode</span> <span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_grayscale_layer_from_slot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">LazyflowSource</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">GrayscaleLayer</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">numberOfChannels</span> <span class="o">=</span> <span class="n">n_channels</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">set_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">drange</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_should_normalize_display</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">set_normalize</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">normalize</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">layer</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_random_colortable_layer_from_slot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">num_colors</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">colortable</span> <span class="o">=</span> <span class="n">generateRandomColors</span><span class="p">(</span><span class="n">num_colors</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span> <span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> <span class="n">zeroIsTransparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">ColortableLayer</span><span class="p">(</span><span class="n">LazyflowSource</span><span class="p">(</span><span class="n">slot</span><span class="p">),</span> <span class="n">colortable</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">colortableIsRandom</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">layer</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_alpha_modulated_layer_from_slot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">AlphaModulatedLayer</span><span class="p">(</span> <span class="n">LazyflowSource</span><span class="p">(</span><span class="n">slot</span><span class="p">),</span>
                                     <span class="n">tintColor</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span> <span class="n">Qt</span><span class="o">.</span><span class="n">cyan</span> <span class="p">),</span>
                                     <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                                     <span class="n">normalize</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">layer</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_binary_mask_layer_from_slot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
        <span class="c1"># 0: black, 1-255: transparent</span>
        <span class="c1"># This works perfectly for uint8.  </span>
        <span class="c1"># For uint32, etc., values of 256,512, etc. will be appear &#39;off&#39;.</span>
        <span class="c1"># But why would you use uint32 for a binary mask anyway? </span>
        <span class="n">colortable</span> <span class="o">=</span> <span class="p">[</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">rgba</span><span class="p">()]</span>
        <span class="n">colortable</span> <span class="o">+=</span> <span class="mi">255</span><span class="o">*</span><span class="p">[</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rgba</span><span class="p">()]</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">ColortableLayer</span><span class="p">(</span><span class="n">LazyflowSource</span><span class="p">(</span><span class="n">slot</span><span class="p">),</span> <span class="n">colortable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">layer</span>
        
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_create_rgba_layer_from_slot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">numChannels</span><span class="p">,</span> <span class="n">lastChannelIsAlpha</span><span class="p">):</span>
        <span class="n">bindex</span> <span class="o">=</span> <span class="n">aindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">rindex</span><span class="p">,</span> <span class="n">gindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">numChannels</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="p">(</span><span class="n">numChannels</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lastChannelIsAlpha</span><span class="p">):</span>
            <span class="n">bindex</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">lastChannelIsAlpha</span><span class="p">:</span>
            <span class="n">aindex</span> <span class="o">=</span> <span class="n">numChannels</span><span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">numChannels</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">gindex</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">numChannels</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">bindex</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">numChannels</span><span class="o">&gt;=</span><span class="mi">4</span><span class="p">:</span>
            <span class="n">aindex</span> <span class="o">=</span> <span class="n">numChannels</span><span class="o">-</span><span class="mi">1</span>

        <span class="n">redSource</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">redProvider</span> <span class="o">=</span> <span class="n">OpSingleChannelSelector</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">slot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">redProvider</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
            <span class="n">redProvider</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">rindex</span> <span class="p">)</span>
            <span class="n">redSource</span> <span class="o">=</span> <span class="n">LazyflowSource</span><span class="p">(</span> <span class="n">redProvider</span><span class="o">.</span><span class="n">Output</span> <span class="p">)</span>
            <span class="n">redSource</span><span class="o">.</span><span class="n">additional_owned_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">redProvider</span> <span class="p">)</span>
        
        <span class="n">greenSource</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">gindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">greenProvider</span> <span class="o">=</span> <span class="n">OpSingleChannelSelector</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">slot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">greenProvider</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
            <span class="n">greenProvider</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">gindex</span> <span class="p">)</span>
            <span class="n">greenSource</span> <span class="o">=</span> <span class="n">LazyflowSource</span><span class="p">(</span> <span class="n">greenProvider</span><span class="o">.</span><span class="n">Output</span> <span class="p">)</span>
            <span class="n">greenSource</span><span class="o">.</span><span class="n">additional_owned_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">greenProvider</span> <span class="p">)</span>
        
        <span class="n">blueSource</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">bindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">blueProvider</span> <span class="o">=</span> <span class="n">OpSingleChannelSelector</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">slot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">blueProvider</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
            <span class="n">blueProvider</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">bindex</span> <span class="p">)</span>
            <span class="n">blueSource</span> <span class="o">=</span> <span class="n">LazyflowSource</span><span class="p">(</span> <span class="n">blueProvider</span><span class="o">.</span><span class="n">Output</span> <span class="p">)</span>
            <span class="n">blueSource</span><span class="o">.</span><span class="n">additional_owned_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">blueProvider</span> <span class="p">)</span>

        <span class="n">alphaSource</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">aindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alphaProvider</span> <span class="o">=</span> <span class="n">OpSingleChannelSelector</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">slot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">alphaProvider</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
            <span class="n">alphaProvider</span><span class="o">.</span><span class="n">Index</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">aindex</span> <span class="p">)</span>
            <span class="n">alphaSource</span> <span class="o">=</span> <span class="n">LazyflowSource</span><span class="p">(</span> <span class="n">alphaProvider</span><span class="o">.</span><span class="n">Output</span> <span class="p">)</span>
            <span class="n">alphaSource</span><span class="o">.</span><span class="n">additional_owned_ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">alphaProvider</span> <span class="p">)</span>
        
        <span class="n">layer</span> <span class="o">=</span> <span class="n">RGBALayer</span><span class="p">(</span> <span class="n">red</span><span class="o">=</span><span class="n">redSource</span><span class="p">,</span> <span class="n">green</span><span class="o">=</span><span class="n">greenSource</span><span class="p">,</span> <span class="n">blue</span><span class="o">=</span><span class="n">blueSource</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alphaSource</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_should_normalize_display</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">redSource</span><span class="p">,</span><span class="n">greenSource</span><span class="p">,</span><span class="n">blueSource</span><span class="p">,</span><span class="n">alphaSource</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">set_range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">drange</span><span class="p">)</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">set_normalize</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">normalize</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">layer</span>
    
    <span class="k">def</span> <span class="nf">_get_numchannels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_should_normalize_display</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">drange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">normalizeDisplay</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># do not normalize if the user provided a range and set normalization to False</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we don&#39;t know the range of the data and normalization is allowed</span>
            <span class="c1"># by the user, create a layer that is auto-normalized.</span>
            <span class="c1"># See volumina.pixelpipeline.datasources for details.</span>
            <span class="c1">#</span>
            <span class="c1"># Even in the case of integer data, which has more than 255 possible values,</span>
            <span class="c1"># (like uint16), it seems reasonable to use this setting as default</span>
            <span class="k">return</span> <span class="kc">None</span> <span class="c1"># means autoNormalize</span>

    <span class="nd">@threadRouted</span>
    <span class="k">def</span> <span class="nf">updateAllLayers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stopped</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">slot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Don&#39;t update in response to value slots.</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_need_update</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Ask for the updated layer list (usually provided by the subclass)</span>
        <span class="n">newGuiLayers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupLayers</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">newGuiLayers</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">filter</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span> <span class="ow">is</span> <span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span> <span class="p">),</span> \
                <span class="s2">&quot;You are attempting to re-use a layer (</span><span class="si">{}</span><span class="s2">).  &quot;</span> \
                <span class="s2">&quot;Your setupOutputs() function may not re-use layer objects.  &quot;</span> \
                <span class="s2">&quot;The layerstack retains ownership of the layers you provide and &quot;</span> \
                <span class="s2">&quot;may choose to clean and delete them without your knowledge.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>

        <span class="n">newNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">newGuiLayers</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newNames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newGuiLayers</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;All layers must have unique names.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;You&#39;re attempting to use these layer names:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">newGuiLayers</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># If the datashape changed, tell the editor</span>
        <span class="c1"># FIXME: This may not be necessary now that this gui doesn&#39;t handle the multi-image case...</span>
        <span class="n">newDataShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determineDatashape</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">newDataShape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">dataShape</span> <span class="o">!=</span> <span class="n">newDataShape</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">dataShape</span> <span class="o">=</span> <span class="n">newDataShape</span>
                       
            <span class="c1"># Find the xyz midpoint</span>
            <span class="n">midpos5d</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">//</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newDataShape</span><span class="p">]</span>

            <span class="c1"># center viewer there</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setViewerPos</span><span class="p">(</span><span class="n">midpos5d</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cropModel</span><span class="o">.</span><span class="n">_crop_extents</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cropModel</span><span class="o">.</span><span class="n">cropZero</span><span class="p">()):</span>
                <span class="n">cropMidPos</span> <span class="o">=</span> <span class="p">[(</span><span class="n">b</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="k">for</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cropModel</span><span class="o">.</span><span class="n">_crop_extents</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">navCtrl</span><span class="o">.</span><span class="n">changeSliceAbsolute</span><span class="p">(</span><span class="n">cropMidPos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">)</span>


        <span class="c1"># Old layers are deleted if</span>
        <span class="c1"># (1) They are not in the new set or</span>
        <span class="c1"># (2) Their data has changed</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">oldLayer</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">oldLayer</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newNames</span><span class="p">:</span>
                <span class="n">needDelete</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newLayer</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">oldLayer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">newGuiLayers</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">needDelete</span> <span class="o">=</span> <span class="n">newLayer</span><span class="o">.</span><span class="n">isDifferentEnough</span><span class="p">(</span><span class="n">oldLayer</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">needDelete</span><span class="p">:</span>
                <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s1">&#39;shortcutRegistration&#39;</span><span class="p">):</span>
                    <span class="n">action_info</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">shortcutRegistration</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ShortcutManager</span><span class="p">()</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span> <span class="n">action_info</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">deleteSelected</span><span class="p">()</span>

        <span class="c1"># Insert all layers that aren&#39;t already in the layerstack</span>
        <span class="c1"># (Identified by the name attribute)</span>
        <span class="n">existingNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">newGuiLayers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existingNames</span><span class="p">:</span>
                <span class="c1"># Insert new</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">layer</span> <span class="p">)</span>

                <span class="c1"># If this layer has an associated shortcut, register it with the shortcut manager</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="s1">&#39;shortcutRegistration&#39;</span><span class="p">):</span>
                    <span class="n">ShortcutManager</span><span class="p">()</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="o">*</span><span class="n">layer</span><span class="o">.</span><span class="n">shortcutRegistration</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Clean up the layer instance that the client just gave us.</span>
                <span class="c1"># We don&#39;t want to use it.</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">clean_up</span><span class="p">()</span>

                <span class="c1"># Move existing layer to the correct position</span>
                <span class="n">stackIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">findMatchingIndex</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">stackIndex</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">stackIndex</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">moveSelectedUp</span><span class="p">()</span>
                    <span class="n">stackIndex</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">stackIndex</span> <span class="o">&lt;</span> <span class="n">index</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="o">.</span><span class="n">moveSelectedDown</span><span class="p">()</span>
                    <span class="n">stackIndex</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">()</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span> <span class="kc">True</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">determineDatashape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">newDataShape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observedSlots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">provider</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">newDataShape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">newDataShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVoluminaShapeForSlot</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newDataShape</span>

    <span class="k">def</span> <span class="nf">getLayerByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Found more than one matching layer with name </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>


    <span class="nd">@threadRouted</span>
    <span class="k">def</span> <span class="nf">setViewerPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">setTime</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">setChannel</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pos5d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validatePos</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            
            <span class="c1"># set xyz position</span>
            <span class="n">pos3d</span> <span class="o">=</span> <span class="n">pos5d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">posModel</span><span class="o">.</span><span class="n">slicingPos</span> <span class="o">=</span> <span class="n">pos3d</span>
            
            <span class="c1"># set time and channel if requested</span>
            <span class="k">if</span> <span class="n">setTime</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">posModel</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">pos5d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">setChannel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">posModel</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">pos5d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">navCtrl</span><span class="o">.</span><span class="n">panSlicingViews</span><span class="p">(</span> <span class="n">pos3d</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">navCtrl</span><span class="o">.</span><span class="n">changeSliceAbsolute</span><span class="p">(</span><span class="n">pos3d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cropModel</span><span class="o">.</span><span class="n">_crop_extents</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cropModel</span><span class="o">.</span><span class="n">cropZero</span><span class="p">()):</span>
                <span class="n">cropMidPos</span> <span class="o">=</span> <span class="p">[(</span><span class="n">b</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span> <span class="k">for</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cropModel</span><span class="o">.</span><span class="n">_crop_extents</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">navCtrl</span><span class="o">.</span><span class="n">changeSliceAbsolute</span><span class="p">(</span><span class="n">cropMidPos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Failed to navigate to position (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">return</span>
    
    <span class="k">def</span> <span class="nf">validatePos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong data format&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="n">dims</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong data format&quot;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">dataShape</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">ds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>                
        <span class="k">return</span> <span class="n">pos</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getVoluminaShapeForSlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use an OpReorderAxes adapter to transpose the shape for us.</span>
            <span class="n">op5</span> <span class="o">=</span> <span class="n">OpReorderAxes</span><span class="p">(</span> <span class="n">parent</span><span class="o">=</span><span class="n">slot</span><span class="o">.</span><span class="n">getRealOperator</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="p">)</span>
            <span class="n">op5</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">slot</span> <span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">op5</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">shape</span>

            <span class="c1"># We just needed the operator to determine the transposed shape.</span>
            <span class="c1"># Disconnect it so it can be garbage collected.</span>
            <span class="n">op5</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="n">op5</span><span class="o">.</span><span class="n">cleanUp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">shape</span>

<div class="viewcode-block" id="LayerViewerGui.initViewerControlUi"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.layerViewer.layerViewerGui.LayerViewerGui.initViewerControlUi">[docs]</a>    <span class="k">def</span> <span class="nf">initViewerControlUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the viewer controls GUI, which appears below the applet bar.</span>
<span class="sd">        In our case, the viewer control GUI consists mainly of a layer list.</span>
<span class="sd">        Subclasses should override this if they provide their own viewer control widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">localDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__viewerControlWidget</span> <span class="o">=</span> <span class="n">ViewerControls</span><span class="p">()</span>

        <span class="c1"># The editor&#39;s layerstack is in charge of which layer movement buttons are enabled</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">layerStack</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__viewerControlWidget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__viewerControlWidget</span><span class="o">.</span><span class="n">setupConnections</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></div>

<div class="viewcode-block" id="LayerViewerGui.initAppletDrawerUi"><a class="viewcode-back" href="../../../../applet_library.html#ilastik.applets.layerViewer.layerViewerGui.LayerViewerGui.initAppletDrawerUi">[docs]</a>    <span class="k">def</span> <span class="nf">initAppletDrawerUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, this base class provides a blank applet drawer.</span>
<span class="sd">        Override this in a subclass to get a real applet drawer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load the ui file (find it in our own directory)</span>
        <span class="n">localDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawer</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUi</span><span class="p">(</span><span class="n">localDir</span><span class="o">+</span><span class="s2">&quot;/drawer.ui&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">getAppletDrawerUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawer</span>

    <span class="k">def</span> <span class="nf">_initCentralUic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the GUI from the ui file into this class and connect it with event handlers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load the ui file into this class (find it in our own directory)</span>
        <span class="n">localDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uic</span><span class="o">.</span><span class="n">loadUi</span><span class="p">(</span><span class="n">localDir</span><span class="o">+</span><span class="s2">&quot;/centralWidget.ui&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crosshair</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Volume Editor GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">VolumeEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">crosshair</span><span class="o">=</span><span class="n">crosshair</span><span class="p">)</span>

        <span class="c1"># Replace the editor&#39;s navigation interpreter with one that has extra functionality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clickReporter</span> <span class="o">=</span> <span class="n">ClickReportingInterpreter</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">navInterpret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">posModel</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">setNavigationInterpreter</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">clickReporter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clickReporter</span><span class="o">.</span><span class="n">rightClickReceived</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleEditorRightClick</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clickReporter</span><span class="o">.</span><span class="n">leftClickReceived</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleEditorLeftClick</span> <span class="p">)</span>
        
        <span class="n">clickReporter2</span> <span class="o">=</span> <span class="n">ClickReportingInterpreter</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingInterpreter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">posModel</span> <span class="p">)</span>
        <span class="n">clickReporter2</span><span class="o">.</span><span class="n">rightClickReceived</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleEditorRightClick</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">brushingInterpreter</span> <span class="o">=</span> <span class="n">clickReporter2</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">setInteractionMode</span><span class="p">(</span> <span class="s1">&#39;navigation&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumeEditorWidget</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">_lastImageViewFocus</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Zoom at a 1-1 scale to avoid loading big datasets entirely...</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">imageViews</span><span class="p">:</span>
            <span class="n">view</span><span class="o">.</span><span class="n">doScaleTo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Should we default to 2D?</span>
        <span class="n">prefer_2d</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">multislot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observedSlots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">multislot</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">slot</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span> <span class="ow">and</span> <span class="n">slot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">prefer_2d</span><span class="p">:</span>
                    <span class="n">prefer_2d</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">prefer_2d</span><span class="p">:</span>
            <span class="c1"># Default to Z (axis 2 in the editor)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumeEditorWidget</span><span class="o">.</span><span class="n">quadview</span><span class="o">.</span><span class="n">ensureMaximized</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_convertPositionToDataSpace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voluminaPosition</span><span class="p">):</span>
        <span class="n">taggedPosition</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">p</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;txyzc&#39;</span><span class="p">,</span> <span class="n">voluminaPosition</span><span class="p">)}</span>

        <span class="c1"># Find the first lazyflow layer in the stack</span>
        <span class="c1"># We assume that all lazyflow layers have the same axistags</span>
        <span class="n">dataTags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">datasource</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">datasources</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="c1"># not all datasources have the dataSlot property, find out by trying</span>
                    <span class="n">dataTags</span> <span class="o">=</span> <span class="n">datasource</span><span class="o">.</span><span class="n">dataSlot</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">axistags</span>
                    <span class="k">if</span> <span class="n">dataTags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dataTags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert mouse click coordinates from volumina-5d: Could not find a lazyflow data source in any layer.&quot;</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">dataTags</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">+=</span> <span class="p">(</span><span class="n">taggedPosition</span><span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">key</span><span class="p">],)</span>

        <span class="k">return</span> <span class="n">position</span>

    <span class="k">def</span> <span class="nf">_handleEditorRightClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position5d</span><span class="p">,</span> <span class="n">globalWindowCoordinate</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convertPositionToDataSpace</span><span class="p">(</span><span class="n">position5d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handleEditorRightClick</span><span class="p">(</span><span class="n">dataPosition</span><span class="p">,</span> <span class="n">globalWindowCoordinate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handleEditorLeftClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position5d</span><span class="p">,</span> <span class="n">globalWindowCoordinate</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerstack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convertPositionToDataSpace</span><span class="p">(</span><span class="n">position5d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handleEditorLeftClick</span><span class="p">(</span><span class="n">dataPosition</span><span class="p">,</span> <span class="n">globalWindowCoordinate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handleEditorRightClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position5d</span><span class="p">,</span> <span class="n">globalWindowCoordinate</span><span class="p">):</span>
        <span class="c1"># Override me</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">handleEditorLeftClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position5d</span><span class="p">,</span> <span class="n">globalWindowCoordiante</span><span class="p">):</span>
        <span class="c1"># Override me</span>
        <span class="k">pass</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">ilastik 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, Christoph Straehle, Bernhard X. Kausler, Thorben Krger, Ullrich Kthe , Fred A. Hamprecht, Anna Kreshuk, Luca Fiaschi, Stuart Berg.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>